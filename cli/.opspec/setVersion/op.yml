description: Sets the version by re-generating the version.go file
name: set-version
inputs:
  version:
    string:
      constraints: { format: semver }
      description: version to set
  srcDir:
    dir:
      default: .
      description: directory containing the projects source code
outputs:
  srcDir:
    dir:
      description: directory containing the projects source code
run:
  container:
    cmd:
      - sh
      - -ce
      - |
        echo "generating version.go"
        cat <<EOF > version.go
        // This file was generated by .opspec/set-version
        package main

        const (
          version = "$(version)"
        )
    dirs:
      /src: $(srcDir)
    image: { ref: 'alpine:3.4' }
    workDir: /src
