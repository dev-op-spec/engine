name: Go

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:

    - name: Check out code
      uses: actions/checkout@v2
      
    - name: Get branch name
      shell: bash
      run: echo "##[set-output name=branch;]$(echo ${GITHUB_HEAD_REF##*/})"
      id: branch_name

    - name: Download opctl
      uses: dsaltares/fetch-gh-release-asset@0.0.5
      with:
        repo: opctl/opctl
        version: latest
        file: opctl0.1.45.linux.tgz
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Extract opctl
      run: tar -xvzf opctl0.1.45.linux.tgz

    - run: ./opctl run -a gitBranch=${{ steps.branch_name.outputs.branch }} build
